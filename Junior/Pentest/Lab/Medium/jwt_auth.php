<?php
function base64UrlDecode($data) {
    $remainder = strlen($data) % 4;
    if ($remainder) {
        $padlen = 4 - $remainder;
        $data .= str_repeat('=', $padlen);
    }
    return base64_decode(strtr($data, '-_', '+/'));
}

$jwt = $_COOKIE['token'] ?? null;

if ($jwt) {
    $parts = explode('.', $jwt);
    if (count($parts) === 3) {
        $payload = json_decode(base64UrlDecode($parts[1]), true);
        if ($payload['user'] === 'admin') {
            echo "Welcome admin!";
            exit;
        } else {
            echo "Hello, " . htmlspecialchars($payload['user']);
            exit;
        }
    }
}

echo "Not authenticated.";
?>
